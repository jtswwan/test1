<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <!-- ğŸ” æ”¾åœ¨ <head> ä¸­ï¼šåŠ ä¸Š LIFF SDK -->
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AIé¢¨æ ¼å¼•å°å•å·</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f5f5f5; }
    .slide { display: none; padding: 2rem; max-width: 800px; margin: 0 auto; background: #fff; min-height: 100vh; box-sizing: border-box; }
    .slide.active { display: block; }
    h1, h2 { text-align: center; }
    label { display: block; margin-top: 1rem; font-weight: bold; }
    input[type="text"], textarea, select, input[type="range"] { width: 100%; padding: 0.5rem; margin-top: 0.5rem; }
    .checkbox-group { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 0.5rem; }
    .checkbox-group label { font-weight: normal; }
    .custom-style { display: flex; gap: 10px; margin-top: 0.5rem; align-items: center; }
    .style-slider { margin-top: 1rem; }
    .slider-label { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem; }
    button { margin-top: 2rem; padding: 0.75rem 1.5rem; font-size: 1rem; background-color: #4CAF50; color: white; border: none; cursor: pointer; }
    button:hover { background-color: #45a049; }
    .button-group { display: flex; justify-content: space-between; flex-wrap: wrap; gap: 1rem; }
    .preview-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 1rem; }
    .preview-box { width: 100%; padding-top: 100%; background: #eaeaea; position: relative; cursor: pointer; border: 2px solid transparent; }
    .preview-box.selected { border-color: #4CAF50; }
    .preview-box span { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #888; font-size: 0.9rem; }
    #contactDesigner { display: none; margin-top: 1rem; text-align: center; color: red; }
  </style>
</head>
<body>

  <div class="slide active" id="slide1">
    <h1>AI é¢¨æ ¼å¼•å°å•å·</h1>
    <label for="usage">é è¨ˆä½¿ç”¨å ´æ™¯ï¼š</label>
    <select id="usage" name="usage" onchange="toggleOtherUsage()">
      <option value="é ­åƒ">å“ç‰Œé ­åƒ</option>
      <option value="åç‰‡">åç‰‡</option>
      <option value="ç¶²ç«™">ç¶²ç«™</option>
      <option value="IG/ç¤¾ç¾¤">IG / ç¤¾ç¾¤</option>
      <option value="å…¶ä»–">å…¶ä»–</option>
    </select>
    <input type="text" id="otherUsage" placeholder="è«‹èªªæ˜å…¶ä»–ç”¨é€”" style="display:none; margin-top: 0.5rem;">
    <div class="button-group">
      <span></span>
      <button onclick="nextSlide()">ä¸‹ä¸€æ­¥</button>
    </div>
  </div>

  <div class="slide" id="slide2">
    <label for="brand">å“ç‰Œåç¨±ï¼š</label>
    <input type="text" id="brand" name="brand" required>

    <label for="description">å“ç‰Œç°¡ä»‹æˆ–æœå‹™å…§å®¹ï¼š</label>
    <textarea id="description" name="description" rows="4" required></textarea>

    <div class="button-group">
      <button onclick="prevSlide()">ä¸Šä¸€æ­¥</button>
      <button onclick="nextSlide()">ä¸‹ä¸€æ­¥</button>
    </div>
  </div>

  <div class="slide" id="slide3">
    <label>å¸Œæœ›çš„å“ç‰Œé¢¨æ ¼ï¼š</label>
    <div class="checkbox-group" id="styleCheckboxes">
      <label><input type="checkbox" value="æ˜äº®" onchange="updateStyleSliders()"> æ˜äº®</label>
      <label><input type="checkbox" value="æš—æ²‰" onchange="updateStyleSliders()"> æš—æ²‰</label>
      <label><input type="checkbox" value="ç°¡ç´„" onchange="updateStyleSliders()"> ç°¡ç´„</label>
      <label><input type="checkbox" value="é«˜ç´š" onchange="updateStyleSliders()"> é«˜ç´š</label>
      <label><input type="checkbox" value="ç«¥è¶£" onchange="updateStyleSliders()"> ç«¥è¶£</label>
      <label><input type="checkbox" value="ç§‘æŠ€æ„Ÿ" onchange="updateStyleSliders()"> ç§‘æŠ€æ„Ÿ</label>
      <label><input type="checkbox" value="æ‰‹ç¹ªæ„Ÿ" onchange="updateStyleSliders()"> æ‰‹ç¹ªæ„Ÿ</label>
    </div>
    <div class="custom-style">
      <input type="text" id="customStyleInput" placeholder="æ–°å¢å…¶ä»–é¢¨æ ¼å½¢å®¹è©">
      <button type="button" onclick="addCustomStyle()">ï¼‹</button>
    </div>
    <div id="styleSliders" class="style-slider"></div>
    <div class="button-group">
      <button onclick="prevSlide()">ä¸Šä¸€æ­¥</button>
      <button onclick="nextSlide()">ä¸‹ä¸€æ­¥</button>
    </div>
  </div>

  <div class="slide" id="slide4">
    <label for="elements">æƒ³åŠ å…¥çš„å…·é«”å…ƒç´ ï¼š</label>
    <textarea id="elements" name="elements" rows="3" placeholder="ä¾‹å¦‚ï¼šè²“ã€å±±ã€åœ“å½¢åœ–é¨°..."></textarea>
    <button onclick="startImageGeneration()">âœ… ç¢ºèªä¸¦é–‹å§‹ç”Ÿæˆåœ–åƒ</button>

    <h2>AI é è¦½åœ–ï¼ˆå¯è¤‡é¸ä½ å–œæ­¡çš„ï¼‰</h2>
    <div class="preview-grid" id="previewGrid">
      <div class="preview-box" onclick="toggleImageSelection(this, 1)"><span>åœ– 1</span></div>
      <div class="preview-box" onclick="toggleImageSelection(this, 2)"><span>åœ– 2</span></div>
      <div class="preview-box" onclick="toggleImageSelection(this, 3)"><span>åœ– 3</span></div>
      <div class="preview-box" onclick="toggleImageSelection(this, 4)"><span>åœ– 4</span></div>
      <div class="preview-box" onclick="toggleImageSelection(this, 5)"><span>åœ– 5</span></div>
      <div class="preview-box" onclick="toggleImageSelection(this, 6)"><span>åœ– 6</span></div>
      <div class="preview-box" onclick="toggleImageSelection(this, 7)"><span>åœ– 7</span></div>
      <div class="preview-box" onclick="toggleImageSelection(this, 8)"><span>åœ– 8</span></div>
      <div class="preview-box" onclick="toggleImageSelection(this, 9)"><span>åœ– 9</span></div>
    </div>
    <button onclick="regenerateImage()">ğŸ” é‡æ–°ç”Ÿæˆåœ–åƒ</button>
    <div id="contactDesigner">æ‰¾ä¸åˆ°å–œæ­¡çš„å—ï¼Ÿ<br><button onclick="alert('ç³»çµ±æœƒé€šçŸ¥è¨­è¨ˆå¸«èˆ‡æ‚¨è¯ç¹«')">ğŸ’¬ æˆ‘æƒ³ç›´æ¥èˆ‡è¨­è¨ˆå¸«æºé€š</button></div>

    <div class="button-group">
      <button onclick="prevSlide()">ä¸Šä¸€æ­¥</button>
      <button onclick="submitForm()">âœ… å®Œæˆé€å‡º</button>
    </div>
  </div>

<script>
  let currentSlide = 0;
  const slides = document.querySelectorAll('.slide');
  let regenerateCount = 0;
  const selectedImages = new Set();
  let userId = "";

  window.onload = async function () {
    await liff.init({ liffId: "2007667595-X0Gx0BwM" });
    if (!liff.isLoggedIn()) {
      liff.login();
    } else {
      const profile = await liff.getProfile();
      userId = profile.userId;
    }
  }

  function showSlide(index) {
    slides.forEach((slide, i) => {
      slide.classList.toggle('active', i === index);
    });
    currentSlide = index;
  }

  function nextSlide() {
    if (currentSlide < slides.length - 1) showSlide(currentSlide + 1);
  }

  function prevSlide() {
    if (currentSlide > 0) showSlide(currentSlide - 1);
  }

  function toggleOtherUsage() {
    const usage = document.getElementById("usage").value;
    const otherInput = document.getElementById("otherUsage");
    otherInput.style.display = usage === "å…¶ä»–" ? "block" : "none";
  }

  function addCustomStyle() {
    const input = document.getElementById("customStyleInput");
    const value = input.value.trim();
    if (value) {
      const checkboxGroup = document.getElementById("styleCheckboxes");
      const label = document.createElement("label");
      label.innerHTML = `<input type="checkbox" value="${value}" checked onchange="updateStyleSliders()"> ${value}`;
      checkboxGroup.appendChild(label);
      input.value = "";
      updateStyleSliders();
    }
  }

  function updateStyleSliders() {
    const checkedStyles = document.querySelectorAll('#styleCheckboxes input:checked');
    const styleSliderDiv = document.getElementById("styleSliders");
    styleSliderDiv.innerHTML = "";
    checkedStyles.forEach(cb => {
      const wrapper = document.createElement("div");
      wrapper.classList.add("slider-label");
      wrapper.innerHTML = `<label>${cb.value}</label><input type="range" min="0" max="100" value="50">`;
      styleSliderDiv.appendChild(wrapper);
    });
  }

  function startImageGeneration() {
    regenerateImage();
  }

  function regenerateImage() {
    regenerateCount++;
    document.querySelectorAll(".preview-box span").forEach((span, index) => {
      span.innerText = `åœ– ${index + 1}ï¼ˆå·²æ›´æ–°ï¼‰`;
    });
    if (regenerateCount >= 2) {
      document.getElementById("contactDesigner").style.display = "block";
    }
  }

  function toggleImageSelection(el, index) {
    el.classList.toggle("selected");
    if (selectedImages.has(index)) {
      selectedImages.delete(index);
    } else {
      selectedImages.add(index);
    }
  }

  async function submitForm() {
    const usage = document.getElementById('usage').value;
    const otherUsage = document.getElementById('otherUsage').value;
    const brand = document.getElementById('brand').value;
    const description = document.getElementById('description').value;
    const elements = document.getElementById('elements').value;
    const styles = [...document.querySelectorAll('#styleCheckboxes input:checked')].map(cb => cb.value).join(', ');
    const likedImages = Array.from(selectedImages).map(i => `åœ– ${i + 1}`).join(', ') || "æœªé¸æ“‡";

    const result = {
      userId: userId,
      usage: usage === 'å…¶ä»–' ? otherUsage : usage,
      brand: brand,
      description: description,
      styles: styles,
      elements: elements,
      likedImages: likedImages
    };

    try {
      await fetch("https://script.google.com/macros/s/AKfycby03JY5arbJyy0tOE2YuqdIMxX072zgsmLHmPUOclGsUNjqIvv6PzmIw9U9GMNB6A/exec", {
        method: "POST",
        body: JSON.stringify(result)
      });

      // ğŸŸ¢ LINE å®˜æ–¹ç™¼é€è¨Šæ¯é€šçŸ¥
      await liff.sendMessages([{
        type: "text",
        text: "âœ… æ„Ÿè¬å¡«å¯«ï¼æˆ‘å€‘å·²æ”¶åˆ°æ‚¨çš„è³‡æ–™ï¼Œè¨­è¨ˆå¸«æœƒç›¡å¿«è¯ç¹«æ‚¨ã€‚"
      }]);

      // ğŸŸ¢ å¯é¸ï¼šçµæŸ LIFF æˆ–è·³æ„Ÿè¬ç•«é¢
      liff.closeWindow();

    } catch (err) {
      alert("é€å‡ºå¤±æ•—ï¼š" + err.message);
    }
  }
</script>
</body>
</html>
